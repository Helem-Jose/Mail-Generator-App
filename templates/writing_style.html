<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analyzing Writing Style</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='writing_style.css') }}" />
  </head>
  <body>
    <div class="container">
      <!-- Loading Spinner -->
      <div class="spinner"></div>
      
      <!-- Heading -->
      <h2>Analyzing your writing style...</h2>
      
      <!-- Description -->
      <p class="description">
        This will help us tailor responses to match how you write.
      </p>
      
      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      
      <!-- Status Text -->
      <p class="status-text" id="statusText">Initializing analysis...</p>
    </div>

    <script>
      async function analyzeStyle() {
        const progressBar = document.getElementById('progressBar');
        const statusText = document.getElementById('statusText');
        
        // Simulate progress
        let progress = 0;
        const progressInterval = setInterval(() => {
          progress += Math.random() * 15;
          if (progress > 90) progress = 90;
          progressBar.style.width = progress + '%';
          
          if (progress < 30) {
            statusText.textContent = 'Collecting email samples...';
          } else if (progress < 60) {
            statusText.textContent = 'Analyzing writing patterns...';
          } else if (progress < 90) {
            statusText.textContent = 'Processing style features...';
          }
        }, 200);
        
        try {
          const reply = await fetch("/get_style");
          console.log(reply);
          
          clearInterval(progressInterval);
          progressBar.style.width = '100%';
          statusText.textContent = 'Analysis complete!';
          
          if (reply.status === 200) {
            setTimeout(() => {
              window.location.href = "/search_window";
            }, 1000);
          } else {
            setTimeout(() => {
              alert("Error analyzing writing style. Please try again.");
            }, 1000);
          }
        } catch (err) {
          clearInterval(progressInterval);
          statusText.textContent = 'Network error occurred';
          setTimeout(() => {
            alert("Network error. Please try again.");
            console.error(err);
          }, 1000);
        }
      }

      window.onload = analyzeStyle;
    </script>
  </body>
</html>
